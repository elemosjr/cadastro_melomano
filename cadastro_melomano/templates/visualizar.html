{% extends "template.html" %}
{% block conteudo %}
<div class="container" style="width: 100%">
    <div id="grid" class="handsontable"></div>
    <hr>
        <div class="container-fluid">
        <a class="btn btn-primary" href="{{ url_for('index') }}">Adicionar outra entrada</a>
        <button class="btn btn-primary botao_salvar" id="salvar">Salvar estado da planilha</button>
        <a class="btn btn-primary" href="{{ url_for('salvar') }}">Download (xlsx)</a>
        <a class="btn btn-danger" style="float: right !important" href="{{ url_for('limpar') }}">Limpar</a>
    </div>
</div>

<script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script src='https://handsontable.com/dist/handsontable.full.js'></script>
<script src='https://rawgit.com/notifyjs/notifyjs/master/dist/notify.js'></script>
<style>.htCore td { white-space:nowrap }</style>

<script>
$(function () {
    var data = {{ data|tojson }};

    var container = document.getElementById('grid'),
    hot = new Handsontable(container, {
        licenseKey: "non-commercial-and-evaluation",
        data: data,
        minSpareRows: 1,
        colHeaders: true,
        contextMenu: true,
        height: "auto",
        colWidths: {{ tamanhos }},
        rowHeights: 25
    });
});

document.getElementById("botao_salvar").addEventListener("click", () => {
    var data = { data: hot.GetData()};
    $.ajax({
        url: "/salvar_estado",
        type: "POST",
        data: JSON.stringify(data),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        async: true
    });
});

</script> 

<!--
Handsontable.Dom.addEvent(save, 'click', function() {
    // save all cell's data
    var arr = { data: hot.getData()};
    $.ajax({
        url: '/json/save/',
        type: 'POST',
        data: JSON.stringify(arr),
        contentType: 'application/json; charset=utf-8',
        dataType: 'json',
        async: true,
        success: function(msg) {
            console.log(msg);
    }
    });
});
-->

{% endblock %}